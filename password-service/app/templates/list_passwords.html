<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>List of Passwords</title>
    <script>
        async function fetchPasswords() {
            const token = localStorage.getItem('authToken'); // Get the token from local storage
            if (!token) {
                alert('You are not logged in. Please log in to continue.');
                window.location.href = '/login'; // Redirect to login if token not found
                return;
            }

            const response = await fetch('http://localhost:5002/list_passwords', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`, // Include the token
                },
            });

            if (response.ok) {
                const passwords = await response.json();
                displayPasswords(passwords);
            } else {
                alert('Failed to fetch passwords. Please log in again.');
                localStorage.removeItem('authToken'); // Clear token if fetch fails
                window.location.href = '/login'; // Redirect to login
            }
        }

        function displayPasswords(passwords) {
            const passwordList = document.getElementById('password-list');
            passwordList.innerHTML = ''; // Clear the list before adding new items

            if (passwords.length === 0) {
                passwordList.innerHTML = '<p>No passwords stored.</p>';
            } else {
                passwords.forEach(p => {
                    const listItem = document.createElement('li');
                    listItem.textContent = `Service: ${p.service} - Password: ***`; // Display the service name and masked password
                    passwordList.appendChild(listItem);
                });
            }
        }

        // Fetch passwords when the page loads
        window.onload = fetchPasswords;
    </script>
</head>
<body>
    <h1>Your Stored Passwords</h1>
    <ul id="password-list">
        <!-- Passwords will be displayed here -->
    </ul>

    <a href="/new_password">Add a New Password</a>
    <a href="/modify_password">Modify a Password</a>
</body>
</html>
